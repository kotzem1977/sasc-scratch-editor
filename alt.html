<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="google" content="notranslate" />
  <title>Scratch 3.0 GUI (alt) — SA SchoolCoding</title>
  <link rel="icon" href="static/favicon.ico" />
  <style>
    html,body{height:100%;margin:0;background:#fff;}
    body{overflow:hidden;}
    #sasc-console{position:fixed;left:8px;bottom:8px;z-index:99999;background:#111;color:#0f0;padding:8px 10px;border-radius:6px;font:12px/1.35 monospace;max-width:min(50vw,520px);max-height:30vh;overflow:auto;box-shadow:0 4px 20px rgba(0,0,0,.4)}
    #sasc-console b{color:#7cf}
  </style>

  <!-- React/Redux UMD -->
  <script src="https://unpkg.com/react@16.14.0/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16.14.0/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/redux@4.2.1/dist/redux.min.js" crossorigin></script>
  <script>
  (function(){
    window.react = window.react || window.React;
    window['react-dom'] = window['react-dom'] || window.ReactDOM;
    window.redux = window.redux || window.Redux;
  })();
  </script>

  <!-- Fetch rewriter (same as index) -->
  <script>
  (function(){
    const log = (...a)=>{ try{ sascLog(...a); }catch(_){ console.log('[SASC]', ...a); } };
    const ORIGIN = location.origin;
    const basePath = location.pathname.replace(/\/[^/]*$/, '/');
    const repoRoot = ORIGIN + basePath;

    function toRepoURL(u){ return new URL(String(u).replace(/^\//,''), repoRoot).toString(); }

    const origFetch = window.fetch && window.fetch.bind(window);
    if (!origFetch) return;

    function rewrite(url){
      try{
        const u = new URL(url, location.href);
        if (u.pathname.includes('//')) u.pathname = u.pathname.replace(/\/{2,}/g,'/');

        if (u.pathname.startsWith('/libraries/') || u.pathname.startsWith('libraries/')) {
          return toRepoURL(u.pathname);
        }
        if (u.pathname.startsWith('/static/') || u.pathname.startsWith('/chunks/')) {
          return toRepoURL(u.pathname);
        }
        const m = u.pathname.match(/^\/?internalapi\/asset\/([a-f0-9]{32}\.\w+)\/get\/?$/i);
        if (m) return toRepoURL('static/assets/' + m[1]);
      }catch(_){}
      return url;
    }

    window.fetch = function(input, init){
      if (typeof input === 'string') {
        const fixed = rewrite(input);
        if (fixed !== input) log('rewrote', input, '→', fixed);
        return origFetch(fixed, init);
      } else if (input && typeof input.url === 'string') {
        const fixed = rewrite(input.url);
        if (fixed !== input.url) {
          log('rewrote', input.url, '→', fixed);
          input = new Request(fixed, input);
        }
        return origFetch(input, init);
      }
      return origFetch(input, init);
    };
  })();
  </script>
</head>
<body>
  <div id="sasc-console"></div>
  <script>
    (function(){
      const el=document.getElementById('sasc-console');
      window.sascLog=function(...a){
        const line=document.createElement('div');
        line.textContent=a.map(x=>typeof x==='string'?x:JSON.stringify(x)).join(' ');
        el.appendChild(line);
        el.scrollTop=el.scrollHeight;
      };
      sascLog('Console ready');
      sascLog('href:', location.href);
      sascLog('React:', !!window.React, 'v', window.React && React.version);
      sascLog('Redux:', !!window.Redux);
    })();
    document.addEventListener('click',e=>{
      try{ sascLog('[click]', e.target.tagName); }catch(_){}
    }, true);
  </script>

  <div id="app" style="height:100%;"></div>

  <script src="scratch-gui.js?v=alt-stable"></script>
  <script> sascLog('GUI script requested'); </script>
</body>
</html>
