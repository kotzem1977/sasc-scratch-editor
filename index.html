<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="google" value="notranslate"/>
  <link rel="shortcut icon" href="static/favicon.ico"/>
  <title>Scratch 3.0 GUI â€” SA SchoolCoding</title>

  <!-- 1) React/ReactDOM globals (needed by the bundle) -->
  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>

  <!-- 2) Minimal Node-ish shims many webpack builds expect -->
  <script>
    window.global = window;
    window.process = window.process || { env: { NODE_ENV: 'production' } };
  </script>

  <!-- 3) Fetch interceptor: route any internalapi asset -> local static/assets/<md5ext> -->
  <script>
  (function () {
    const origFetch = window.fetch && window.fetch.bind(window);
    if (!origFetch) return;

    const INTERNAL_ASSET_RE = /\/internalapi\/asset\/([0-9a-f]{32}\.[a-z0-9]+)\/get\/?$/i;
    const isScratchAssetHost = h => (h === 'assets.scratch.mit.edu' || h === 'cdn.assets.scratch.mit.edu');

    function toLocalAssetURL(md5ext) {
      const basePath = location.pathname.replace(/\/[^/]*$/, '/'); // keep repo subpath
      return new URL('static/assets/' + md5ext, location.origin + basePath).toString();
    }
    function rewrite(url) {
      try {
        const u = new URL(url, location.href);

        // From Scratch hosts
        if (isScratchAssetHost(u.hostname)) {
          const m = u.pathname.match(INTERNAL_ASSET_RE);
          if (m) return toLocalAssetURL(m[1]);
        }
        // From our own origin (some builds do /internalapi on same host)
        {
          const m = u.pathname.match(INTERNAL_ASSET_RE);
          if (m) return toLocalAssetURL(m[1]);
        }
      } catch (_) {}
      return url;
    }

    window.fetch = function (input, init) {
      if (typeof input === 'string') {
        return origFetch(rewrite(input), init);
      } else if (input && typeof input.url === 'string') {
        const newURL = rewrite(input.url);
        if (newURL !== input.url) input = new Request(newURL, input);
        return origFetch(input, init);
      }
      return origFetch(input, init);
    };
  })();
  </script>

  <!-- 4) Your built GUI bundle -->
  <script defer src="scratch-gui.js"></script>

  <style>
    html,body {height:100%;margin:0}
    body {overflow:hidden;background:#111}
  </style>
</head>
<body></body>
</html>
