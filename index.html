<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="google" value="notranslate"/>
  <link rel="shortcut icon" href="static/favicon.ico"/>
  <title>Scratch 3.0 GUI — SA SchoolCoding</title>

  <!-- React/DOM UMD (16.14; compatible with Scratch GUI) -->
  <script src="https://unpkg.com/react@16.14.0/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16.14.0/umd/react-dom.production.min.js" crossorigin></script>
  <!-- react-is UMD (needed by some deps) -->
  <script src="https://unpkg.com/react-is@16.13.1/umd/react-is.production.min.js" crossorigin></script>

  <!-- Expose globals the way the UMD bundle expects -->
  <script>
    // Node-ish env shim some libs expect
    window.global = window;
    window.process = window.process || { env: { NODE_ENV: 'production' } };

    // Map to the LOWERCASE keys that webpack’s UMD wrapper uses
    // scratch-gui bundle often calls factory(root["react"], root["react-dom"], root["react-is"], …)
    (function aliasUMDGlobals(){
      if (window.React)       window.react = window.React;
      if (window.ReactDOM)    window['react-dom'] = window.ReactDOM;
      if (window.ReactIs)     window['react-is']  = window.ReactIs;
    })();

    // Early sanity checks (helpful if CDN hiccups)
    if (!window.react || !window.react.forwardRef) {
      console.error('[Bootstrap] React global missing or wrong: window.react=', window.react);
    }
    if (!window['react-dom']) {
      console.error('[Bootstrap] ReactDOM global missing');
    }
  </script>

  <!-- Intercept Scratch asset fetches and point them to local /static/assets/<md5ext> -->
  <script>
  (function () {
    const origFetch = window.fetch && window.fetch.bind(window);
    if (!origFetch) return;

    const INTERNAL_ASSET_RE = /\/internalapi\/asset\/([0-9a-f]{32}\.[a-z0-9]+)\/get\/?$/i;
    const isScratchAssetHost =
      h => (h === 'assets.scratch.mit.edu' || h === 'cdn.assets.scratch.mit.edu');

    function toLocalAssetURL(md5ext) {
      const basePath = location.pathname.replace(/\/[^/]*$/, '/'); // keep repo subpath
      return new URL('static/assets/' + md5ext, location.origin + basePath).toString();
    }
    function rewrite(url) {
      try {
        const u = new URL(url, location.href);

        // From Scratch hosts
        if (isScratchAssetHost(u.hostname)) {
          const m = u.pathname.match(INTERNAL_ASSET_RE);
          if (m) return toLocalAssetURL(m[1]);
        }
        // From our own origin
        {
          const m = u.pathname.match(INTERNAL_ASSET_RE);
          if (m) return toLocalAssetURL(m[1]);
        }
      } catch (_) {}
      return url;
    }

    window.fetch = function (input, init) {
      if (typeof input === 'string') {
        return origFetch(rewrite(input), init);
      } else if (input && typeof input.url === 'string') {
        const newURL = rewrite(input.url);
        if (newURL !== input.url) input = new Request(newURL, input);
        return origFetch(input, init);
      }
      return origFetch(input, init);
    };
  })();
  </script>

  <!-- Load the built Scratch GUI bundle (defer keeps order after UMDs) -->
  <script>
    (function(){
      var s = document.createElement('script');
      s.defer = true;
      s.src = 'scratch-gui.js?v=umd-aliases';
      s.onerror = function(e){ console.error('[Bootstrap] Failed to load scratch-gui.js', e); };
      document.head.appendChild(s);
    })();
  </script>

  <style>
    html,body {height:100%;margin:0}
    body {overflow:hidden;background:#111}
  </style>
</head>
<body></body>
</html>
