<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="google" value="notranslate" />
    <link rel="shortcut icon" href="static/favicon.ico" />
    <title>Scratch 3.0 GUI â€” SA SchoolCoding</title>

    <!-- Main editor bundle -->
    <script defer src="gui.js"></script>

    <!-- Autosave/restore bridge (localStorage) -->
    <script>
      (function () {
        const KEY = "sasc_autosave";
        const SAVE_MS = 10000;

        function getVM() {
          // VM is exposed by the build as window.vm in most prebuilt bundles
          try {
            return window.vm && typeof window.vm.toJSON === "function"
              ? window.vm
              : null;
          } catch (_) {
            return null;
          }
        }

        function tryRestore() {
          try {
            const vm = getVM();
            if (!vm) return false;
            const saved = localStorage.getItem(KEY);
            if (saved) {
              // loadProject accepts a JSON string in these builds
              vm.loadProject(saved);
            }
            return true;
          } catch (_) {
            return false;
          }
        }

        function startAutoSave() {
          try {
            const vm = getVM();
            if (!vm) return false;
            if (window.__sascSaver) return true; // guard against duplicates
            window.__sascSaver = setInterval(() => {
              try {
                const v = getVM();
                if (!v) return;
                const json = v.toJSON();
                localStorage.setItem(KEY, json);
              } catch (_) {}
            }, SAVE_MS);
            return true;
          } catch (_) {
            return false;
          }
        }

        // Wait until the page (and gui.js) are loaded, then poll for VM
        function tick() {
          if (tryRestore() & startAutoSave()) return;
          setTimeout(tick, 500);
        }
        window.addEventListener("load", tick);
      })();
    </script>

    <style>
      /* Not required, just keeps body from showing scrollbars while the app renders */
      html, body { height: 100%; margin: 0; }
      body { overflow: hidden; background: #0f0f0f; }
    </style>
  </head>
  <body></body>
</html>

